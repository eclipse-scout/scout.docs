////
Howto:
- Write this document such that it helps people to migrate. Describe what they should do.
- Chronological order is not necessary.
- Choose the right top level chapter (java, js, other)
- Use "WARNING: {NotReleasedWarning}" on its own line to mark parts about not yet released code (also add a "(since <version>)" suffix to the chapter title)
- Use "title case" in chapter titles (https://english.stackexchange.com/questions/14/)
////

ifndef::finaldoc[]
include::../_initDoc.adoc[]
endif::finaldoc[]

// double underscore
:dus: __

== About This Document

This document describes all relevant changes *from Eclipse Scout {scout-previous-version} to Eclipse Scout {scout-version}*. If existing code has to be migrated, instructions are provided here.

WARNING: {NotReleasedWarning}

== Obtaining the Latest Version

=== Scout Runtime for Java

Scout Runtime artifacts for Java are distributed using Maven Central:

* {maven-central-link} on _Maven Central_
* {mvnrepository-link} on _mvnrepository.com_

Usage example in the parent POM of your Scout application:

[source,xml]
[subs="verbatim,attributes"]
----
<dependency>
    <groupId>org.eclipse.scout.rt</groupId>
    <artifactId>org.eclipse.scout.rt</artifactId>
    <version>{maven-version}</version>
    <type>pom</type>
    <scope>import</scope>
</dependency>
----

=== Scout Runtime for JavaScript

Scout Runtime artifacts for JavaScript are distributed using npm:

* https://www.npmjs.com/package/@eclipse-scout/core[Scout Core Runtime]
* https://www.npmjs.com/search?q=%40eclipse-scout[All official Scout JavaScript packages]

Usage example in your package.json:

[source,json]
[subs="verbatim,attributes"]
----
{
  "name": "my-module",
  "version": "1.0.0",
  "devDependencies": {
    "@eclipse-scout/cli": "{node-version}",
    "@eclipse-scout/releng": "^22.0.0"
  },
  "dependencies": {
    "@eclipse-scout/core": "{node-version}",
    "jquery": "3.6.0"
  }
}
----

The pre-built Scout JavaScript assets are also available using a CDN (e.g. to be directly included in a html document):
https://www.jsdelivr.com/package/npm/@eclipse-scout/core?path=dist

=== IDE Tooling (Scout SDK)

Scout officially supports https://www.jetbrains.com/idea/[IntelliJ IDEA] and {scout-sdk-download-link}.

==== IntelliJ IDEA

You can download the Scout plugin for IntelliJ IDEA from the https://plugins.jetbrains.com/plugin/13393-eclipse-scout/[JetBrains Plugin Repository] or you can use the plugins client built into IntelliJ IDEA.
Please refer to the https://www.jetbrains.com/help/idea/managing-plugins.html[IntelliJ Help] on how to install and manage plugins.

==== Eclipse

You can download the complete Eclipse IDE with Scout SDK included here: +
{scout-sdk-download-link}

To install the Scout SDK into your existing Eclipse IDE, use this P2 update site: +
{scout-sdk-update-site}

// ----------------------------------------------------------------------------

== Rename WidgetTooltip.widget (Scout JS)

The `widget` property of `WidgetTooltip` has been renamed to `content`.
Together with the property itself the corresponding setter has been renamed from `setWidget` to `setContent`.

== ObjectType as Class Reference (Scout JS)

As described in the {release-notes-link}, it is now possible to use class references for the `objectType`.
Even though the string based style still works and a migration is not necessary, the class reference style is the preferred way for the future.

If you would like to migrate your code, here is how we did it (we used IntelliJ for the process).

. Find and replace all occurrences of `scout.create()`, `objectType:` and `lookupCall:` (use Ctrl-Shift-R in IntelliJ and enable Regex).
+
[source]
----
Find: scout.create\('(.*\.)?(.*)'
Replace: scout.create\($2
----
+
[source]
----
Find: objectType: '(.*\.)?(.*)'
Replace: objectType: $2
----
+
[source]
----
Find: lookupCall: '(.*\.)?(.*)'
Replace: lookupCall: $2
----

The regex considers objectTypes with and without namespace.

. Add imports  +
Now we need to add the required imports.
You can either manually add them, but with a lot of files it is a tedious task.
Unfortunately, IntelliJ does not provide a possibility to automatically add all missing imports.
But there is a trick: resolve multiple inspections at once using code analysis.

.. Start the action `Run inspection by name` and select the inspection `Unresolved JavaScript variable`.
+
.Start Action
image::{mgimgsdir}/unresolved-variable-inspection.png[]
.Select inspection
image::{mgimgsdir}/unresolved-variable-inspection-1.png[]
.. Select `Uncommitted files` and disable all inspection options, because the inspection is not limited to missing imports.
Click OK to run the analysis.
+
.Run Action
image::{mgimgsdir}/unresolved-variable-inspection-2.png[]

.. In the result view, select one or more problems and click the button `Missing import statement`.
+
Note: Sometimes `Missing import statement` is located in a drop down called `Apply quick fixes to all the problems`.
+
Note: Even though we disabled all inspection options, there may still be problems other than `Missing import statement`.
If that is the case, resolving multiple problems is not possible unless you unselect these problems including theirs parent node.
+
.Resolve problems
image::{mgimgsdir}/unresolved-variable-inspection-3.png[]
.Button in drop down
image::{mgimgsdir}/unresolved-variable-inspection-3a.png[]

.. Finally, you need to verify, whether the imports are correct.
Please make sure all imports are present for every object type and the classes are imported from a module and not a single file.
+
.Good import
[source,js]
----
import {Button, GroupBox} from '@eclipse-scout/core';
----
+
.Bad import
[source,js]
----
import Button from '@eclipse-scout/core/src/form/fields/button/Button.js';
----

== options-parameter for filter-methods in menus.js (Scout JS)

The methods `filter` and `filterAccordingToSelection` in `menus.js` now have an options-parameter. This parameter combines the former parameters `onlyVisible`, `enableDisableKeyStrokes` and `notAllowedTypes`.
The following are two migration examples:

.Old
[source,js]
----
let allowedTypes = ['Example.MenuType'],
  onlyVisible = true,
  enableDisableKeyStrokes = false;

// example 1
menus.filter(this.menus, allowedTypes, true, false);

// example 2
menus.filter(this.menus, allowedTypes, onlyVisible, enableDisableKeyStrokes);

----

.New
[source,js]
----
let allowedTypes = ['Example.MenuType'],
  onlyVisible = true,
  enableDisableKeyStrokes = false;

// example 1
menus.filter(this.menus, allowedTypes, {
  onlyVisible: true,
  enableDisableKeyStrokes: false
});

// example 2
menus.filter(this.menus, allowedTypes, {onlyVisible, enableDisableKeyStrokes});

----

=== Namespace

TODO describe registerNamespace

== Rename WidgetPopup.widget (Scout JS & Scout Classic)

The `widget` property on `WidgetPopup` classes (and all its subclasses) has been renamed to `content`:

. Scout JS
.. Update the `widget` property in all JS models creating WidgetPopups from `widget` to `content`.
.. Rename the `_renderWidget` method on subclasses of `WidgetPopup` to `_renderContent`.
.. `setWidget` on WidgetPopups has been renamed to `setContent`.
. Scout Classic
.. `IWidgetPopup#PROP_WIDGET` has been renamed to `IWidgetPopup#PROP_CONTENT`.
.. `IWidgetPopup#getWidget` has been renamed to `IWidgetPopup#getContent`.
.. `AbstractWidgetPopup#getConfiguredWidget` as been renamed to `AbstractWidgetPopup#getConfiguredContent`.
.. `AbstractWidgetPopup#createWidget` as been renamed to `AbstractWidgetPopup#createContent`.
.. `AbstractWidgetPopup#setWidget` as been renamed to `AbstractWidgetPopup#setContent`.

== Rename ProposalChooser.model (Scout JS)

The `model` property on `ProposalChooser` classes (and all its subclasses) has been renamed to `content`:

. Scout JS
.. Rename the `_createModel` method on subclasses of `ProposalChooser` to `_createContent`.
.. Rename the `_renderModel` method on subclasses of `ProposalChooser` to `_renderContent`.

== JQuery

The following functions have been removed because they are not in use anymore.

- removeThis
- suppressEventIfDisabled
- colorOpacity
- animateSVG
- copyCssIfGreater
- backupSelection
- restoreSelection
- onSingleOrDoubleClick

The following functions have been renamed

. widthToContent -> cssWidthToContentAnimated

== Table (Scout JS)

TableFilter.js has been removed because it is has no benefit.

With TypeScript, the interface `Filter<TableRow>` should be used instead.
With JavaScript, `extends from TableFilter` can be removed.

== karma-jasmine-scout (Scout JS)

The following functions have been removed because they are not in use anymore.

- stripCommentsFromJson
- definedProperty
- sameProperty
- JQuery.triggerMouseMove
- JQuery.triggerWithPosition

The following functions have been renamed.

- widgetCloneProperty

The jquery-plugin jqueryExtensions has been refactored to a ES6 module to avoid pollution (of code completion) of the JQuery object outside test environment.
In the rare case you used these functions for testing, you need to import them now, the JQuery-object does not contain them anymore.
